services:
  
  schedule_friend_bot:
    container_name:
       schedule_friend_bot
    build: 
      .
    env_file: 
      .env
    environment:
      TZ: 
        Europe/Berlin
      DB_PATH: 
        /app/data/tasks.db
      REDIS_URL: 
        redis://redis:6397/0
    volumes:
      - ./data:/app/data
      - ./:/app
    restart: 
      unless-stopped
    depends_on:
      redis:
        condition:
          service_healthy
    
    healthcheck:
      test: 
        [
          "CMD-SHELL",
          "python -c \"import os, sqlite3; p=os.environ.get('DB_PATH','/app/data/tasks.db'); sqlite3.connect(p).execute('select 1'); print('ok')\""
        ]
      interval: 
        30s
      timeout: 
        5s
      retries: 
        3
      start_period: 
        20s

  redis:
    container_name:
       schedule_friend_bot_redis   
    image:
      redis:7-alpine
    restart:
      unless-stopped
    
    healthcheck:
      test: 
        ["CMD", "redis-cli", "ping"]
      interval: 
        1m30s
      timeout: 
        30s
      retries: 
        5
      start_period: 
        30s